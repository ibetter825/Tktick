(function($,window,document,undefined){var Tagging=function(elem,options){this.elem=elem;this.$elem=$(elem);this.options=options;this.tags=[]};Tagging.prototype={keys:{add:{comma:188,enter:13,spacebar:32,},remove:{del:46,backspace:8,}},defaults:{"case-sensitive":false,"close-char":"&times;","close-class":"tag-i","edit-on-delete":true,"forbidden-chars":[".","_","?"],"forbidden-chars-callback":window.alert,"forbidden-chars-text":"Forbidden character:","forbidden-words":[],"forbidden-words-callback":window.alert,"forbidden-words-text":"Forbidden word:","no-backspace":false,"no-comma":false,"no-del":false,"no-duplicate":true,"no-duplicate-callback":window.alert,"no-duplicate-text":"Duplicate tag:","no-enter":false,"no-spacebar":false,"pre-tags-separator":", ","tag-box-class":"tagging","tag-char":"#","tag-class":"tag","tags-input-name":"tag","tag-on-blur":true,"type-zone-class":"type-zone",},add:function(text){var $tag,l,self,index,forbidden_words,callback_f,callback_t;self=this;if($.isArray(text)){return $.each(text,function(){self.add(this+"")})}forbidden_words=self.config["forbidden-words"];if(!text){text=self.valInput();self.emptyInput()}if(!text||!text.length){return false}if(!self.config["case-sensitive"]){text=text.toLowerCase()}l=forbidden_words.length;while(l--){index=text.indexOf(forbidden_words[l]);if(index>=0){self.emptyInput();callback_f=self.config["forbidden-words-callback"];callback_t=self.config["forbidden-words-text"];return self.throwError(callback_f,callback_t,text);}}if(self.config["no-duplicate"]){l=self.tags.length;while(l--){if(self.tags[l].pure_text===text){self.emptyInput();callback_f=self.config["no-duplicate-callback"];callback_t=self.config["no-duplicate-text"];return self.throwError(callback_f,callback_t,text);}}}$tag=$(document.createElement("div")).addClass(self.config["tag-class"]).html("<span>"+self.config["tag-char"]+"</span> "+text);$(document.createElement("input")).attr("type","hidden").attr("name",self.config["tags-input-name"]+"[]").val(text).appendTo($tag);$(document.createElement("a")).attr("role","button").addClass(self.config["close-class"]).html(self.config["close-char"]).click(function(){self.remove($tag)}).appendTo($tag);$tag.pure_text=text;self.tags.push($tag);self.$type_zone.before($tag);return true},addSpecialKeys:function(arr){var self,value,to_add,obj,type;self=this;type=arr[0];obj=arr[1];to_add={};if($.isArray(obj)){return $.each(obj,function(){self.addSpecialKeys([type,this])})}if((!obj)&&(obj.constructor!==Object)){return"Error -> The second argument is not an Object!"}for(value in obj){if(obj.hasOwnProperty(value)){if(obj[value]===+obj[value]&&obj[value]===(obj[value]|0)){$.extend(to_add,obj)}}}self.keys[type]=$.extend({},to_add,self.keys[type]);return self.keys[type]},destroy:function(){this.$elem.find("."+this.config["type-zone-class"]).remove();this.$elem.find("."+this.config["tag-class"]).remove();this.$elem.data("tag-box",null);return true},emptyInput:function(){this.focusInput();return this.valInput("")},focusInput:function(){return this.$type_zone.focus()},getDataOptions:function(){var key,data_option,data_options;data_options={};for(key in this.defaults){data_option=this.$elem.data(key);if(data_option){data_options[key]=data_option}}return data_options},getSpecialKeys:function(){return $.extend({},this.keys.add,this.keys.remove)},getSpecialKeysD:function(){return this.keys},getTags:function(){var all_txt_tags,i,l;l=this.tags.length;all_txt_tags=[];for(i=0;i<l;i+=1){all_txt_tags.push(this.tags[i].pure_text)}return all_txt_tags},getTagsObj:function(){return this.tags},init:function(){var init_text,self,text;self=this;self.config=$.extend({},self.defaults,self.options,self.getDataOptions());init_text=self.$elem.text();self.$elem.empty();self.$type_zone=$(document.createElement("input")).addClass(self.config["type-zone-class"]).attr("contenteditable",true);self.$elem.addClass(self.config["tag-box-class"]).append(self.$type_zone);self.$type_zone.keydown(function(e){var key,index,l,pressed_key,all_keys,forbidden_chars,actual_text,callback_f,callback_t;all_keys=self.getSpecialKeys();forbidden_chars=self.config["forbidden-chars"];actual_text=self.valInput();pressed_key=e.which;if(!actual_text){for(key in all_keys){if(pressed_key===all_keys[key]){if(self.keys.add[key]){e.preventDefault();return true}if(self.keys.remove[key]){if(!self.config["no-"+key]){e.preventDefault();return self.remove()}}}}}else{l=forbidden_chars.length;while(l--){index=actual_text.indexOf(forbidden_chars[l]);if(index>=0){e.preventDefault();actual_text=actual_text.replace(forbidden_chars[l],"");self.focusInput();self.valInput(actual_text);callback_f=self.config["forbidden-chars-callback"];callback_t=self.config["forbidden-chars-text"];return self.throwError(callback_f,callback_t,forbidden_chars[l]);}}for(key in self.keys.add){if(pressed_key===self.keys.add[key]){if(!self.config["no-"+key]){e.preventDefault();return self.add()}}}}return true});if(self.config["tag-on-blur"]){self.$type_zone.focusout(function(){text=self.valInput();if(!text||!text.length){return false}return self.add()})}self.$elem.on("click",function(){self.focusInput()});self.refresh(init_text);return self},refresh:function(text){var self,separator;self=this;separator=self.config["pre-tags-separator"];text=text||self.getTags().join(separator);self.reset();$.each(text.split(separator),function(){self.add(this+"")});return true},remove:function($tag){var self,text,l;self=this;if($.isArray($tag)){return $.each($tag,function(){self.remove(this+"")})}if(typeof $tag==="string"){text=$tag;$tag=self.$elem.find("input[value="+text+"]").parent();if(!$tag.length){return"Error -> Tag not found"}}if(!$tag){$tag=self.tags.pop()}else{l=self.tags.length;while(l--){if(self.tags[l][0].innerHTML===$tag[0].innerHTML){self.tags.splice(l,1)}}}text=text||$tag.pure_text;$tag.remove();if(self.config["edit-on-delete"]){self.emptyInput();self.valInput($tag.pure_text)}return $tag},removeAll:function(){return this.reset()},removeSpecialKeys:function(arr){var self,value,to_add,key_code,type;self=this;type=arr[0];key_code=arr[1];to_add={};if($.isArray(key_code)){return $.each(key_code,function(){self.removeSpecialKeys([type,this])})}for(value in self.keys[type]){if(self.keys[type].hasOwnProperty(value)){if(self.keys[type][value]===key_code){self.keys[type][value]=undefined}}}return self.keys[type]},reset:function(){while(this.tags.length){this.remove(this.tags[this.tags.length])}this.emptyInput();return this.tags},throwError:function(callback_f,callback_t,tag_text){return callback_f([callback_t+" '"+tag_text+"'."]);},valInput:function(text){if(text==null){return this.$type_zone.val()}return this.$type_zone.val(text)},};$.fn.tagging=function(arg1,arg2){var results=[];this.each(function(){var $this,tagging,val;$this=$(this);tagging=$this.data("tag-box");if(!tagging){tagging=new Tagging(this,arg1);$this.data("tag-box",tagging);tagging.init();results.push(tagging.$elem)}else{val=tagging[arg1](arg2);if(val){results.push(val)}}});if(typeof arg1==="string"){return(results.length>1)?results:results[0]}return results}})(window.jQuery,window,document);(function($,window,document,undefined){$(document).ready(function(){var t=$(".tagging-js").tagging();t[0].addClass("form-control")})})(window.jQuery,window,document);